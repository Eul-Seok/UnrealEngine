# PSO (Pipeline State Object)

PSO(Pipeline State Object)는 렌더링에 필요한 GPU의 상태를 하나로 묶은 객체입니다. 최신 그래픽스 API(DirectX 12, Vulkan 등)는 이 PSO를 사용하여 렌더링 상태를 한 번에 설정함으로써 CPU 오버헤드를 크게 줄입니다. PSO에는 셰이더, 블렌드 모드, 뎁스 설정 등 수많은 파라미터가 포함됩니다.

하지만 새로운 PSO를 생성하는 과정은 매우 느려서, 게임 플레이 중에 발생할 경우 눈에 띄는 끊김(Hitch, 프레임 드랍)의 원인이 됩니다.

## PSO 캐싱이란?

PSO 캐싱은 게임 플레이에 필요한 모든 PSO를 미리 수집하고 컴파일하여 캐시 파일로 저장해두는 최적화 기법입니다. 언리얼 엔진은 이 캐시를 게임 시작 시 또는 로딩 화면에서 미리 로드하여, 런타임에 비싼 비용의 PSO 생성 작업을 피함으로써 프레임 드랍을 방지합니다.

## PSO 데이터 수집 방법

언리얼 엔진은 PSO 데이터를 수집하기 위한 두 가지 주요 방법을 제공합니다.

### 1. 수동 PSO 캐싱 (Bundled Cache)

전통적으로 사용되던 방식으로, 다음과 같은 과정을 거칩니다.

1.  **PSO 데이터 수집**: `-logpso` 커맨드 라인 옵션을 붙여 게임을 실행한 후, QA 테스터나 개발자가 모든 콘텐츠와 시나리오를 직접 플레이하며 사용되는 모든 PSO를 기록합니다.
2.  **캐시 파일 생성**: 수집된 로그 데이터를 기반으로 빌드 머신에서 커맨드릿(Commandlet)을 실행하여 최종 `.pso.cache` 파일을 생성합니다.
3.  **캐시 파일 번들링**: 생성된 캐시 파일을 게임 빌드에 포함시킵니다. 이 파일은 게임 시작 시 로드되어 필요한 PSO를 미리 컴파일합니다.

이 방식은 효과적이지만, 모든 게임 콘텐츠를 수동으로 플레이해야 하므로 번거롭고 누락이 발생하기 쉽습니다.

### 2. 자동 PSO 프리캐싱 (Automatic PSO Precaching)

언리얼 엔진 5.1부터 도입된 새로운 시스템으로, PSO 수집 과정을 자동화하는 것을 목표로 합니다.

-   에셋이 로드될 때 해당 에셋의 렌더링에 필요한 모든 PSO를 엔진이 자동으로 식별합니다.
-   식별된 PSO는 백그라운드 스레드에서 비동기적으로 컴파일됩니다.
-   이 방식은 수동 개입을 최소화하지만, 100% 완전한 커버리지를 보장하지 못할 수 있어 종종 수동 캐싱 방식과 병행하여 사용됩니다.

## 설정

-   **Project Settings**: `Project Settings` > `Packaging` > `Shader Pipeline Cache` 관련 옵션을 통해 기본 설정을 제어할 수 있습니다.
-   **Device Profiles**: `Device Profiles`에서 플랫폼별로 다른 캐싱 전략을 지정할 수 있습니다.
-   **콘솔 변수**:
    -   `r.ShaderPipelineCache.Enabled=1`: PSO 캐싱 기능을 활성화합니다.
    -   `r.PSOPrecaching=1`: 자동 PSO 프리캐싱 기능을 활성화합니다.
